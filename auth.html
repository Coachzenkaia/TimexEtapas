<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://p.trellocdn.com/power-up.min.css">
    <script src="https://p.trellocdn.com/power-up.min.js"></script>
    <style>
        body { text-align: center; padding: 20px; }
        button { font-size: 16px; }
    </style>
</head>
<body>
    <p>Por favor, autoriza el acceso a tu cuenta de Trello.</p>
    <button id="auth-btn" class="mod-primary">Autorizar</button>

    <script>
        // Obtenemos el objeto de Trello para este iframe
        const t = window.TrelloPowerUp.iframe();

        // Al hacer clic en el botón de autorizar
        document.getElementById('auth-btn').addEventListener('click', function() {
            t.authorize({
                type: 'popup',
                name: 'TimexEtapas',
                scope: {
                    read: true, // Pedimos permiso de lectura
                },
                expiration: 'never', // El token no expira
                success: function() {
                    // Trello nos da un token temporal para guardarlo
                    const token = t.arg('token');
                    if (token) {
                        // Guardamos el token de forma privada para este usuario
                        // y luego cerramos la ventana emergente
                        return t.set('member', 'private', 'token', token)
                            .then(function() {
                                return t.closePopup();
                            });
                    }
                },
                error: function() {
                    alert('Autorización fallida. Por favor, intenta de nuevo.');
                    t.closePopup();
                }
            });
        });
    </script>
</body>
</html>